 pipeline {
      agent any 
      stages {
        stage('Clone sources') {
            steps {
                git url: 'https://github.com/henrimfonzie/TP-CI-CD.git'
            }
        }

      stage('build') {
            steps {
        sh 'docker build -t python-tp:1.0 Docker/Dockerfile'
        sh 'docker tag python-tp:1.0 henrimfonzie/python-tp-k8s:1.0'
        sh 'docker push henrimfonzie/python-tp-k8s:1.0'
        sh 'docker tag python-tp:1.0 henrimfonzie/python-tp-k8s'
            }
        }
       stage('Compile') { // Compile and do unit testing
             tools {
               gradle 'installGradle'
             }
             steps {
               // run Gradle to execute compile and unit testing
               sh 'gradle pylint'
             }
           }
        stage('testcode') {
            steps {
                sh 'python src/main.py'
            }
        }
      }
 }